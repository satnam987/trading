<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Trading Journal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .table { border-radius: 10px; overflow: hidden; }
    .positive { color: green; }
    .negative { color: red; }
    .chart-container { height: 400px; }
  </style>
</head>
<body>
  <div class="container my-5">
    <header class="text-center mb-4">
      <h1 class="display-4">Trading Journal</h1>
      <p class="lead">Track your trades professionally</p>
    </header>

    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Add New Trade</h5>
        <form id="addTradeForm">
          <div class="row g-3">
            <div class="col-md-3">
              <input type="date" class="form-control" id="tradeDate" required>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="tradePair" required>
                <option value="">Select Pair</option>
                <option value="EURUSD">EURUSD</option>
                <option value="TECH100">TECH100</option>
                <option value="BTCUSD">BTCUSD</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="tradeDirection" required>
                <option value="">Direction</option>
                <option value="buy">Buy</option>
                <option value="sell">Sell</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="number" class="form-control" id="entryPrice" placeholder="Entry Price" step="0.01" required>
            </div>
            <div class="col-md-3">
              <input type="number" class="form-control" id="exitPrice" placeholder="Exit Price" step="0.01" required>
            </div>
            <div class="col-md-3">
              <input type="number" class="form-control" id="tradeSize" placeholder="Size" step="0.01" required>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control" id="tradeStrategy" placeholder="Strategy (optional)">
            </div>
            <div class="col-md-3">
              <button type="submit" class="btn btn-primary w-100">Add Trade</button>
            </div>
            <div class="col-12">
              <textarea class="form-control" id="tradeNotes" rows="2" placeholder="Notes"></textarea>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Trade Journal</h5>
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Pair</th>
              <th>Direction</th>
              <th>Entry</th>
              <th>Exit</th>
              <th>Size</th>
              <th>P&L</th>
              <th>Strategy</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tradesTbody"></tbody>
          <tfoot>
            <tr class="fw-bold">
              <td colspan="6">Total P&L</td>
              <td id="totalPnL">0.00</td>
              <td colspan="3"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Cumulative P&L Trend</h5>
        <div class="chart-container">
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button id="btnExportJson" class="btn btn-secondary me-2">Export JSON</button>
      <button id="btnExportCsv" class="btn btn-secondary">Export CSV</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
  <script>
    const trades = [];
    const STORAGE_KEY = 'trading:journal.v1';
    const AVAILABLE_PAIRS = ['EURUSD', 'TECH100', 'BTCUSD'];

    function createId() {
      return Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    function toISODateOnly(d = new Date()) {
      return d.toISOString().split('T')[0];
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed.trades)) {
            trades.push(...parsed.trades);
          }
        }
      } catch (_) {}
      render();
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ trades }));
    }

    function calculatePnL(trade) {
      const diff = trade.direction === 'buy' ? (trade.exit - trade.entry) : (trade.entry - trade.exit);
      return diff * trade.size;
    }

    function addTrade(tradeData) {
      trades.push({
        id: createId(),
        ...tradeData
      });
      saveState();
      render();
    }

    function removeTrade(id) {
      const idx = trades.findIndex(t => t.id === id);
      if (idx !== -1) trades.splice(idx, 1);
      saveState();
      render();
    }

    function render() {
      const tbody = document.getElementById('tradesTbody');
      let totalPnL = 0;
      tbody.innerHTML = '';
      trades
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .forEach(t => {
          const pnl = calculatePnL(t);
          totalPnL += pnl;
          const row = document.createElement('tr');
          row.dataset.id = t.id;
          row.innerHTML = `
            <td>${t.date}</td>
            <td>${t.pair}</td>
            <td>${t.direction}</td>
            <td>${t.entry.toFixed(2)}</td>
            <td>${t.exit.toFixed(2)}</td>
            <td>${t.size.toFixed(2)}</td>
            <td class="${pnl >= 0 ? 'positive' : 'negative'}">${pnl.toFixed(2)}</td>
            <td>${t.strategy || ''}</td>
            <td>${t.notes || ''}</td>
            <td><button class="btn btn-sm btn-danger remove-btn">Delete</button></td>
          `;
          tbody.appendChild(row);
        });

      document.getElementById('totalPnL').textContent = totalPnL.toFixed(2);
      document.getElementById('totalPnL').className = totalPnL >= 0 ? 'positive' : 'negative';

      renderChart();
    }

    function renderChart() {
      const ctx = document.getElementById('trendChart').getContext('2d');
      const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
      let cumulative = 0;
      const labels = sortedTrades.map(t => t.date);
      const data = sortedTrades.map(t => {
        cumulative += calculatePnL(t);
        return cumulative;
      });

      new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Cumulative P&L',
            data,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    document.getElementById('addTradeForm').addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      addTrade({
        date: formData.get('tradeDate'),
        pair: formData.get('tradePair'),
        direction: formData.get('tradeDirection'),
        entry: parseFloat(formData.get('entryPrice')),
        exit: parseFloat(formData.get('exitPrice')),
        size: parseFloat(formData.get('tradeSize')),
        strategy: formData.get('tradeStrategy'),
        notes: formData.get('tradeNotes')
      });
      e.target.reset();
    });

    document.getElementById('tradesTbody').addEventListener('click', e => {
      if (e.target.classList.contains('remove-btn')) {
        const id = e.target.closest('tr').dataset.id;
        removeTrade(id);
      }
    });

    document.getElementById('btnExportJson').addEventListener('click', () => {
      const data = JSON.stringify({ trades }, null, 2);
      downloadBlob(data, 'trading-journal.json', 'application/json');
    });

    document.getElementById('btnExportCsv').addEventListener('click', () => {
      const header = 'Date,Pair,Direction,Entry,Exit,Size,P&L,Strategy,Notes\n';
      const rows = trades.map(t => `${t.date},${t.pair},${t.direction},${t.entry},${t.exit},${t.size},${calculatePnL(t)},${t.strategy},${t.notes}`).join('\n');
      downloadBlob(header + rows, 'trading-journal.csv', 'text/csv');
    });

    function downloadBlob(content, filename, type) {
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    loadState();
  </script>
</body>
</html>

